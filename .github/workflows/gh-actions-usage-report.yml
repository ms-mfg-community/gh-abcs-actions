name: 00. GitHub Actions Usage Report (WIP)

on:
  workflow_dispatch:
  schedule:
    #        ┌─────────────── minute
    #        │ ┌──────────── hour
    #        │ │ ┌────────── day (month)
    #        │ │ │ ┌──────── month
    #        │ │ │ │ ┌────── day (week)
    - cron: '0 1 * * *'

permissions:
  contents: read

jobs:
  organization:
    name: Organization Actions Usage Report
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Get Token
        id: get_workflow_token
        # pinned to v3
        uses: peter-murray/workflow-application-token-action@baa1ef2638c3d9e5967b7c8b86219f8fc919e1bb
        with:
          application_id: ${{ secrets.GH_ABCS_APP_ACTIONS_APP_ID }}
          application_private_key: "${{ secrets.GH_ABCS_APP_ACTIONS_APP_PRIVATE_KEY }}"
          #permissions: "actions:write,contents:read,deployments:read"

      # pinned to v2.5.1
      - uses: ActionsDesk/report-action-usage@b5edc7c28d564be14e8945d5b72e206ded6e9849
        id: action-usage-report
        with:
          token: ${{steps.get_workflow_token.outputs.token}} #${{ secrets.ORG_ADMIN_PAT_TOKEN }}
          owner: githubabcs

      - run: |
          echo "${{ steps.action-usage-report.outputs.csv_result }}"
          echo "${{ steps.action-usage-report.outputs.md_result }}"